<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Experts">

	<insert id="insert" parameterType="expert">
		insert into expert_table
		(expert_jumin1, expert_jumin2, expert_name, expert_id, expert_pass, expert_phone1, expert_phone2, expert_phone3,
		expert_email1, expert_email2)
		values(#{expert_jumin1},#{expert_jumin2}, #{expert_name}, 
				#{expert_id}, #{expert_pass}, #{expert_phone1}, #{expert_phone2}, #{expert_phone3}, 
				#{expert_email1}, #{expert_email2})
	</insert>
	

	<select id="idcheck" resultType="expert" parameterType="String">
		select * from expert_table 
		where expert_id = #{expert_id}
	</select>
	
	<update id="expertupdate" parameterType="expert">
		update expert_table
		set expert_pass = #{expert_pass}, expert_phone2 = #{expert_phone2}, expert_phone3 = #{expert_phone3},
				expert_email1 =  #{expert_email1}, expert_email2 =  #{expert_email2}
		where expert_id = #{expert_id}
	</update>
	
	<select id="expertList" resultType="expert">
		select expert_id, expert_name, expert_phone1, expert_phone2, expert_phone3, expert_email1, expert_email2
		from expert_table
	</select>

	<select id="expertcount" resultType="int">
		select count(*) from
		expert_table
	</select>

	<select id="expertlist" resultType="map">
	select *
	from
			(select rownum rnum, b.* 
	  		from (select E.* , P.PF_CATE,P.PF_SAVEPROFILE,P.PF_One
        	     from expert_table E,PORTFOLIO P
        	     where e.expert_ID =  p.PF_EXID	) 	
		b)	  
		where rnum &gt; = #{start} and rnum &lt; =
		#{end}
	</select>
	

	<select id="expertdetails" resultType="expert"
		parameterType="String">
		select * from expert_table
		where expert_id = #{expertid}
	</select>
	
	<insert id="insertRequest"  parameterType="java.util.Map">	       

		<selectKey keyProperty="request_no" resultType="java.lang.Integer" order="AFTER">
	        SELECT request_seq.CURRVAL FROM DUAL
	    </selectKey>

	INSERT INTO REQUEST			
		(REQUEST_NO, EXPERT_ID, WRITER, WRITER_TYPE, BUILDING_TYPE, BUILDING_TEXT, REPAIR_TYPE, REPAIR_TEXT, SIMPLE_REQ_TEXT, REQUEST_DATE)	
	VALUES(request_seq.NEXTVAL, #{expert_id}, #{writer}, #{writer_type}, #{building_type}, #{building_text}, #{repair_type}, #{repair_text}, #{simple_req_text}, SYSDATE)
	</insert>


	<insert id="insertRequestFileData"  parameterType="java.util.Map">	       
	INSERT INTO REQUEST_FILE	
			(FILE_NO, REQUEST_NO, FILE_NAME, FILE_ORIGINAL, FILE_THUMB_NAME, REQUEST_FILE_DATE)	
	VALUES (request_file_seq.NEXTVAL, #{request_no}, #{file_name}, #{file_original}, #{file_thumb_name}, SYSDATE)	
	</insert>
	
	<select id="reserveCount" parameterType="String" resultType="int">
		select count(*)
		from request
		where writer = #{user_id}
	</select>
	
	<select id="reserveList" parameterType="map" resultType="map">
		select *
		from (select rownum rnum, r.*
				  from (	select r.expert_id, r.writer, e.expert_name, p.pf_grade, p.pf_cate, p.pf_saveprofile
	 						from request r inner join
	  			 					 expert_table e on r.expert_id = e.expert_id left outer join
	  			 					 portfolio p on r.expert_id = p.pf_exid
	  						where r.writer = #{user_id}
	  						) r
	  			 )
		where rnum &gt; = #{start} and rnum &lt; = #{end}
	</select>
	
	<select id="poselect" resultType="portfolio" parameterType="String">
		select * from PORTFOLIO where PF_EXID = #{expert_id}
	</select>

	<select id="RequestCount" resultType="int">
		  select count(*) from REQUEST where expert_id = #{expert_id}
	</select>
	
	
	<resultMap id="PortfolioResult" type="hashMap" >
    	<result property="PF_DESC" column="PF_DESC" jdbcType="CLOB" javaType="java.lang.String" />
    	<result property="PF_INTRO" column="PF_INTRO" jdbcType="CLOB" javaType="java.lang.String" /> 	
	</resultMap>
	
	<select id="PoList" resultMap="PortfolioResult" parameterType="hashMap">
		  select * from PORTFOLIO where PF_EXID = #{expert_id}
	</select>

	<insert id="insertReservation" parameterType="reservation">
		insert into RESERVATION
		(RS_EXID, RS_UID)
		values(#{rs_exid}, #{rs_uid})
	</insert>
</mapper>